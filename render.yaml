# Render Blueprint for one-click deploy (free tier)
# Uses VoyageAI for chunking to minimize cold start time

envVarGroups:
  - name: roam-semantic-secrets
    envVars:
      - key: VOYAGEAI_API_KEY
        sync: false

services:
  - type: web
    name: roam-semantic-backend
    runtime: image
    image:
      url: ghcr.io/maskys/roam-embeddings-search-backend:latest
    envVars:
      - key: ROAM_GRAPH_NAME
        sync: false
      - key: ROAM_API_TOKEN
        sync: false
      - key: WEAVIATE_CLOUD_URL
        sync: false
      - key: WEAVIATE_CLOUD_API_KEY
        sync: false
      - key: CHUNKER_SERVICE_URL
        fromService:
          name: roam-semantic-chunker
          type: web
          property: hostport
      - fromGroup: roam-semantic-secrets
    disk:
      name: sync-data
      mountPath: /app/data
      sizeGB: 1
    startCommand: uvicorn services.search_service:app --host 0.0.0.0 --port 8000
    healthCheckPath: /

  - type: web
    name: roam-semantic-chunker
    runtime: image
    image:
      url: ghcr.io/maskys/roam-embeddings-search-chunker:latest
    envVars:
      - key: CHUNKER_EMBEDDING_PROVIDER
        value: voyageai
      - key: CHUNKER_VOYAGE_MODEL
        value: voyage-3-lite
      - fromGroup: roam-semantic-secrets
    startCommand: uvicorn services.chunker_service:app --host 0.0.0.0 --port 8003
    healthCheckPath: /health
